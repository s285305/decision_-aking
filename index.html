<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision-Making Quiz Platform</title>
    <style>
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1a6b85;
            --color-success: #32b8c6;
            --color-error: #c0152f;
            --color-background: #fcfcf9;
            --color-surface: #ffffff;
            --color-text: #134252;
            --color-text-secondary: #626c7c;
            --color-border: rgba(94, 82, 64, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid var(--color-border);
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background-color: rgba(33, 128, 160, 0.05);
        }

        .filter-section {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            color: var(--color-text);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkbox-item input {
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 14px;
        }

        .quiz-container {
            background-color: var(--color-surface);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--color-border);
        }

        .question-number {
            color: var(--color-text-secondary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--color-text);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--color-surface);
            font-size: 14px;
        }

        .option:hover {
            border-color: var(--color-primary);
            background-color: rgba(33, 128, 160, 0.03);
        }

        .option.selected {
            border-color: var(--color-primary);
            background-color: rgba(33, 128, 160, 0.08);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background-color: rgba(50, 184, 198, 0.1);
            border-left: 4px solid var(--color-success);
            color: var(--color-success);
        }

        .feedback.incorrect {
            background-color: rgba(192, 21, 47, 0.1);
            border-left: 4px solid var(--color-error);
            color: var(--color-error);
        }

        .explanation {
            margin-top: 10px;
            font-size: 14px;
            line-height: 1.6;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: space-between;
        }

        .btn-group button {
            flex: 1;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--color-border);
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-primary);
            transition: width 0.3s ease;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
        }

        .redo-section {
            background-color: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .redo-title {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 10px;
        }

        .redo-list {
            list-style: none;
        }

        .redo-item {
            padding: 10px;
            background-color: var(--color-background);
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 3px solid var(--color-error);
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-surface);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--color-primary);
        }

        @media (max-width: 640px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 22px;
            }

            .quiz-container {
                padding: 15px;
            }

            .btn-group {
                flex-direction: column;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Decision-Making Quiz Platform</h1>
            <p class="subtitle">Test your knowledge on Project Cycle Management, Stakeholder Analysis & Decision-Making</p>
        </header>

        <div class="controls">
            <button class="btn-primary" onclick="startQuiz()">Start Quiz</button>
            <button class="btn-secondary" onclick="showRedoQuestions()">Redo Questions</button>
            <button class="btn-secondary" onclick="toggleFilters()">Filter Questions</button>
            <button class="btn-secondary" onclick="resetProgress()">Reset All</button>
        </div>

        <div id="filterSection" class="filter-section" style="display: none;">
            <label class="filter-label">Topics:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-pcm" checked>
                    <label for="filter-pcm">Project Cycle Management</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-stakeholders" checked>
                    <label for="filter-stakeholders">Stakeholders Analysis</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-mcda" checked>
                    <label for="filter-mcda">MCDA & Evaluation</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-swot" checked>
                    <label for="filter-swot">SWOT Analysis</label>
                </div>
            </div>
        </div>

        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-box">
                <div class="stat-value" id="statCorrect">0</div>
                <div class="stat-label">Correct</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="statTotal">0</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="statPercentage">0%</div>
                <div class="stat-label">Score</div>
            </div>
        </div>

        <div id="progressContainer" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div id="mainContent">
            <div class="empty-state">
                <div class="empty-state-icon">üìö</div>
                <p>Click "Start Quiz" to begin testing your knowledge!</p>
            </div>
        </div>

        <div id="redoModal" class="modal">
            <div class="modal-content">
                <div class="modal-title">Questions to Redo</div>
                <div id="redoContent"></div>
                <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeRedoModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        const quizzes = [
            { id: 1, topic: "pcm", question: "What is the primary characteristic of a project?", options: ["It is a permanent organization", "It has a temporary, organized nature with specific objectives and a clear beginning and end", "It is a routine activity", "It has unlimited budget"], correct: 1, explanation: "A project is defined as a temporary, organized human endeavor that seeks to accomplish specific objectives." },
            { id: 2, topic: "pcm", question: "Which phase of the Project Cycle Management comes first?", options: ["Implementation & Monitoring", "Final Evaluation", "Design", "Submission & Approval"], correct: 2, explanation: "The project cycle begins with Design (Phase 1)." },
            { id: 3, topic: "stakeholders", question: "What is a stakeholder?", options: ["Only the project manager", "Any person, group, or organization who can be impacted by the project", "Only government agencies", "Only funding organizations"], correct: 1, explanation: "A stakeholder is anyone who has interest in the project." },
            { id: 4, topic: "stakeholders", question: "In a Power-Interest Matrix, where should key stakeholders be positioned?", options: ["High power, low interest", "Low power, high interest", "High power, high interest", "Low power, low interest"], correct: 2, explanation: "Key stakeholders should be in the high power, high interest quadrant." },
            { id: 5, topic: "mcda", question: "What does SWOT stand for?", options: ["Strengths, Weaknesses, Opportunities, Threats", "Strategy, Work, Operations, Tasks", "Skills, Workforce, Organization, Technology", "Sector, Workflow, Objectives, Teams"], correct: 0, explanation: "SWOT is an acronym for Strengths and Weaknesses and Opportunities and Threats." },
            { id: 6, topic: "swot", question: "In SWOT analysis, which quadrant contains internal positive attributes?", options: ["Strengths", "Weaknesses", "Opportunities", "Threats"], correct: 0, explanation: "Strengths are internal attributes that are helpful." },
            { id: 7, topic: "pcm", question: "What is the purpose of a Problem Tree?", options: ["To list solutions", "To identify core problem and cause-effect relationships", "To determine budget", "To assign responsibilities"], correct: 1, explanation: "A Problem Tree helps visualize cause-effect relationships." },
            { id: 8, topic: "stakeholders", question: "What is the difference between first and second level stakeholders?", options: ["No difference", "First level has direct interests, second level has indirect interests", "Only first level matters", "Second level is more important"], correct: 1, explanation: "First level stakeholders have direct interests, second level have specific but indirect interests." },
            { id: 9, topic: "mcda", question: "What is MCDA?", options: ["Military strategy", "Multi-Criteria Decision Analysis", "Management system", "Market analysis"], correct: 1, explanation: "MCDA allows consideration of multiple objectives simultaneously." },
            { id: 10, topic: "swot", question: "Which SWOT elements are external?", options: ["Strengths", "Weaknesses", "Opportunities and Threats", "All of them"], correct: 2, explanation: "Opportunities and Threats are external factors." },
            { id: 11, topic: "pcm", question: "What is the Logical Framework (LogFrame) used for?", options: ["To allocate project funds", "To structure project information including objectives, indicators, and assumptions", "To schedule timeline only", "To determine project location"], correct: 1, explanation: "The LogFrame is a management tool that structures project information into a coherent narrative." },
            { id: 12, topic: "pcm", question: "What is the purpose of a Problem Tree in project identification?", options: ["To list all possible solutions", "To identify the core problem and establish cause-effect relationships", "To determine the budget", "To assign team responsibilities"], correct: 1, explanation: "A Problem Tree helps visualize cause-effect relationships and identify root causes." },
            { id: 13, topic: "pcm", question: "What is the Objective Tree used for?", options: ["To allocate project budget", "To describe future situation and identify means-end relationships", "To schedule activities", "To identify risks"], correct: 1, explanation: "The Objective Tree transforms problems into positive, achievable objectives." },
            { id: 14, topic: "pcm", question: "What is a results-based approach in project management?", options: ["Only focusing on costs", "Seeking clearly defined objectives and outcomes with coordinated activities", "Ignoring intermediate outcomes", "Measuring only financial results"], correct: 1, explanation: "Results-based approach seeks clearly defined objectives with coordinated activities." },
            { id: 15, topic: "pcm", question: "What is 'outputs' versus 'outcomes'?", options: ["Same thing", "Outputs are direct products; outcomes are broader changes", "Outcomes are not important", "No distinction exists"], correct: 1, explanation: "Outputs are immediate deliverables; outcomes are changes resulting from using outputs." },
            { id: 16, topic: "pcm", question: "What is a project indicator?", options: ["Not necessary", "Measurable variable showing progress toward objectives", "Only financial", "Only at project end"], correct: 1, explanation: "Indicators are specific, measurable statements tracking progress toward objectives." },
            { id: 17, topic: "pcm", question: "What is project sustainability?", options: ["Only environmental concern", "Outcomes and benefits continue after external support ends", "Not relevant", "Too expensive"], correct: 1, explanation: "Sustainability means project benefits persist beyond implementation phase." },
            { id: 18, topic: "pcm", question: "What is the difference between formative and ex-post evaluation?", options: ["Same thing", "Formative is during implementation; ex-post is after completion", "Only ex-post matters", "Formative is unnecessary"], correct: 1, explanation: "Formative evaluation occurs during implementation; ex-post after project ends." },
            { id: 19, topic: "pcm", question: "What is attribution in project evaluation?", options: ["Not necessary", "Establishing causal links between project activities and outcomes", "Optional", "Guessing results"], correct: 1, explanation: "Attribution answers whether project caused observed changes." },
            { id: 20, topic: "pcm", question: "What is counterfactual analysis?", options: ["Too complex", "Comparison with similar non-beneficiaries to isolate impact", "Not scientific", "Not useful"], correct: 1, explanation: "Counterfactual analysis compares beneficiaries with control groups." },
            { id: 21, topic: "stakeholders", question: "What are the five main categories of stakeholders?", options: ["Managers only", "Political actors, bureaucratic actors, special interests, general interests, and experts", "Rich and poor only", "Young and old only"], correct: 1, explanation: "The five categories represent different stakeholder bases and interests." },
            { id: 22, topic: "stakeholders", question: "What are the four types of resources stakeholders can mobilize?", options: ["Only financial", "Political, economic, legal, and cognitive resources", "Land and labor only", "Public and private only"], correct: 1, explanation: "Stakeholders can mobilize four types of resources in projects." },
            { id: 23, topic: "stakeholders", question: "What determines stakeholder legitimacy?", options: ["Only government actors", "Just interest in system, right to impose requirements, or willingness to participate", "Only wealthy actors", "Not determinable"], correct: 1, explanation: "Legitimacy is based on interest, rights, and willingness to participate." },
            { id: 24, topic: "stakeholders", question: "What is stakeholder salience?", options: ["Not relevant", "Combination of power, legitimacy, and urgency", "Only visibility", "Cannot be measured"], correct: 1, explanation: "Stakeholder salience combines power, legitimacy, and urgency attributes." },
            { id: 25, topic: "stakeholders", question: "What is inclusive participation?", options: ["Powerful groups only", "Ensuring marginalized stakeholders have meaningful voice", "Only for social projects", "Cannot be achieved"], correct: 1, explanation: "Inclusive participation ensures diverse stakeholders have meaningful voice." },
            { id: 26, topic: "stakeholders", question: "What is stakeholder capacity building?", options: ["Not important", "Developing stakeholders' knowledge, skills, and resources", "Unnecessary cost", "Only for large organizations"], correct: 1, explanation: "Capacity building ensures stakeholders can effectively participate." },
            { id: 27, topic: "stakeholders", question: "What is stakeholder accountability?", options: ["Not necessary", "Project's responsibility to transparently report on commitments and results", "Only to funding agencies", "Cannot be measured"], correct: 1, explanation: "Accountability establishes project credibility and trust." },
            { id: 28, topic: "stakeholders", question: "How do stakeholder expectations differ from needs?", options: ["Same thing", "Needs are requirements; expectations may be aspirational", "Only needs matter", "Expectations not important"], correct: 1, explanation: "Needs reflect requirements; expectations may be hopes or desires." },
            { id: 29, topic: "stakeholders", question: "What is conflict mapping in stakeholder analysis?", options: ["Military strategy", "Identifying agreement and disagreement between stakeholder groups", "Not useful", "Too complicated"], correct: 1, explanation: "Conflict mapping visualizes stakeholder positions to anticipate collaboration or conflict." },
            { id: 30, topic: "stakeholders", question: "How should vulnerable stakeholders be handled?", options: ["Exclude them", "Identify and ensure equitable participation and benefits", "Not possible", "Too time-consuming"], correct: 1, explanation: "Vulnerable stakeholders need special attention for equitable participation." },
            { id: 31, topic: "mcda", question: "What is Multi-Criteria Decision Analysis (MCDA)?", options: ["Single criterion analysis", "Allows consideration of multiple objectives and heterogeneous measures", "Guarantees best solution", "Only for financial decisions"], correct: 1, explanation: "MCDA allows simultaneous consideration of multiple criteria." },
            { id: 32, topic: "mcda", question: "What are the main steps of the MCDA process?", options: ["Only identify options", "Establish context, identify options, identify criteria, describe performance, weight criteria, aggregate scores, examine results, sensitivity analysis", "Just surveys", "Skip criteria selection"], correct: 1, explanation: "MCDA has 8 key steps from establishing context to sensitivity analysis." },
            { id: 33, topic: "mcda", question: "What is a performance matrix in MCDA?", options: ["Not necessary", "Table showing how each alternative performs on each criterion", "Only financial analysis", "Optional tool"], correct: 1, explanation: "Performance matrix is central to MCDA comparing alternatives and criteria." },
            { id: 34, topic: "mcda", question: "What is weighting in MCDA?", options: ["Not necessary", "Assigning importance values to criteria reflecting preferences", "All equal", "Optional step"], correct: 1, explanation: "Weights quantify relative importance of criteria in decision-making." },
            { id: 35, topic: "mcda", question: "What is normalization in MCDA?", options: ["Making everything normal", "Converting performance data into comparable scales", "Not necessary", "Only for quantitative"], correct: 1, explanation: "Normalization standardizes criteria into dimensionless values for comparison." },
            { id: 36, topic: "mcda", question: "What is a trade-off in decision-making?", options: ["Not relevant", "Accepting lower performance on one criterion for better performance on another", "Impossible", "Only cost-benefit"], correct: 1, explanation: "Trade-offs reflect compromise between competing criteria." },
            { id: 37, topic: "mcda", question: "What is pairwise comparison in MCDA?", options: ["Comparing all together", "Comparing two alternatives at a time to determine preference", "Not useful", "Only qualitative"], correct: 1, explanation: "Pairwise comparison simplifies decision-making by focusing on two items." },
            { id: 38, topic: "mcda", question: "What is the Analytical Hierarchy Process (AHP)?", options: ["Only hierarchies", "Decomposes decision into hierarchy, evaluates through pairwise comparisons", "Cannot use stakeholders", "Too simple"], correct: 1, explanation: "AHP breaks decision into hierarchy evaluated through pairwise comparisons." },
            { id: 39, topic: "mcda", question: "What is sensitivity analysis in MCDA?", options: ["To complicate", "To test how results change with different weights or preferences", "Not necessary", "Confirm one answer"], correct: 1, explanation: "Sensitivity analysis examines robustness of results to parameter changes." },
            { id: 40, topic: "mcda", question: "What is the Delphi Method?", options: ["Financial decisions only", "Achieves convergence of opinions for decision-making", "Replaces judgment", "Eliminates conflict"], correct: 1, explanation: "Delphi achieves consensus and extracts useful information for decisions." },
            { id: 41, topic: "swot", question: "How are internal and external factors organized in SWOT?", options: ["All treated equally", "Internal (Strengths/Weaknesses) vs External (Opportunities/Threats)", "Only external matters", "Alphabetically"], correct: 1, explanation: "SWOT matrix distinguishes internal from external and positive from negative." },
            { id: 42, topic: "swot", question: "What is the main purpose of SWOT analysis?", options: ["To criticize", "To provide comprehensive understanding of strategy factors", "Eliminate weaknesses", "Make complex"], correct: 1, explanation: "SWOT helps decision-makers understand factors affecting strategy." },
            { id: 43, topic: "swot", question: "What is a weakness in SWOT analysis?", options: ["To criticize", "Internal attributes harmful to achievement of objectives", "Not constructive", "Ignore them"], correct: 1, explanation: "Weaknesses identify improvement areas and resource gaps." },
            { id: 44, topic: "swot", question: "Which SWOT quadrant represents future potential challenges?", options: ["Strengths", "Weaknesses", "Opportunities", "Threats"], correct: 3, explanation: "Threats are external risks and potential obstacles." },
            { id: 45, topic: "swot", question: "How can opportunities be identified?", options: ["Guessing", "Market research, trend analysis, stakeholder interviews", "Only experts", "Random"], correct: 1, explanation: "Opportunities emerge from systematic external analysis and research." },
            { id: 46, topic: "swot", question: "What is a strategic option in SWOT?", options: ["No relationship", "How SWOT factors combine: S+O=Growth, S+T=Stability, W+O=Diversification, W+T=Retrenchment", "All strategies same", "Independent"], correct: 1, explanation: "SWOT combinations guide strategy formulation with different options." },
            { id: 47, topic: "swot", question: "How should SWOT analysis be conducted?", options: ["By one person", "Participatory workshop with stakeholders and experts", "In isolation", "Without discussion"], correct: 1, explanation: "SWOT is most effective as participatory analysis with diverse perspectives." },
            { id: 48, topic: "swot", question: "What does resource analysis include in SWOT?", options: ["Only financial", "Assessment of human, financial, technological, informational resources", "No analysis needed", "External only"], correct: 1, explanation: "Resource analysis assesses organizational capabilities and strengths." },
            { id: 49, topic: "swot", question: "When should SWOT analysis be updated?", options: ["Once never again", "Regularly as conditions change", "Never update", "Only crisis"], correct: 1, explanation: "SWOT is dynamic and should be updated as circumstances change." },
            { id: 50, topic: "swot", question: "What is a scenario based on SWOT?", options: ["Not useful", "Plausible future combining different SWOT factors", "Only past", "Just predictions"], correct: 1, explanation: "Scenarios help visualize possible futures from SWOT analysis." }
        ];

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answeredQuestions = {};
        let redoQuestions = [];
        let quizActive = false;

        function getFilteredQuizzes() {
            const filters = {
                pcm: document.getElementById('filter-pcm').checked,
                stakeholders: document.getElementById('filter-stakeholders').checked,
                mcda: document.getElementById('filter-mcda').checked,
                swot: document.getElementById('filter-swot').checked
            };
            return quizzes.filter(q => filters[q.topic]);
        }

        function startQuiz() {
            currentQuiz = getFilteredQuizzes();
            if (currentQuiz.length === 0) {
                alert("Please select at least one topic filter.");
                return;
            }
            currentQuiz = currentQuiz.sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = {};
            redoQuestions = [];
            quizActive = true;
            document.getElementById('statsSection').style.display = 'flex';
            document.getElementById('progressContainer').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }
            const q = currentQuiz[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            let html = `
                <div class="quiz-container">
                    <div class="question-number">Question ${currentQuestionIndex + 1} of ${currentQuiz.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options">
                        ${q.options.map((option, idx) => `
                            <div class="option ${answeredQuestions[q.id] === idx ? 'selected' : ''}" 
                                 onclick="selectOption(${idx}, ${q.id})"
                                 ${answeredQuestions[q.id] !== undefined ? 'style="pointer-events: none;"' : ''}>
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    ${answeredQuestions[q.id] !== undefined ? `
                        <div class="feedback show ${answeredQuestions[q.id] === q.correct ? 'correct' : 'incorrect'}">
                            <strong>${answeredQuestions[q.id] === q.correct ? '‚úì Correct!' : '‚úó Incorrect'}</strong>
                            <div class="explanation">${q.explanation}</div>
                        </div>
                    ` : ''}
                    <div class="btn-group">
                        <button class="btn-secondary" onclick="previousQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''}>‚Üê Previous</button>
                        <button class="btn-primary" onclick="nextQuestion()" style="flex: 2;">${currentQuestionIndex === currentQuiz.length - 1 ? 'Finish' : 'Next'} ‚Üí</button>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = html;
            updateStats();
        }

        function selectOption(idx, qId) {
            answeredQuestions[qId] = idx;
            const q = currentQuiz.find(x => x.id === qId);
            if (idx === q.correct) {
                score++;
            } else {
                redoQuestions.push(qId);
            }
            showQuestion();
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuiz.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function updateStats() {
            const answered = Object.keys(answeredQuestions).length;
            const percentage = answered > 0 ? Math.round((score / answered) * 100) : 0;
            document.getElementById('statCorrect').textContent = score;
            document.getElementById('statTotal').textContent = answered;
            document.getElementById('statPercentage').textContent = percentage + '%';
        }

        function showResults() {
            quizActive = false;
            const answered = Object.keys(answeredQuestions).length;
            const percentage = Math.round((score / answered) * 100);
            
            let html = `
                <div class="quiz-container">
                    <h2 style="text-align: center; color: var(--color-primary); margin-bottom: 20px;">Quiz Complete! üéâ</h2>
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value">${score}</div>
                            <div class="stat-label">Correct</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${answered - score}</div>
                            <div class="stat-label">Incorrect</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${percentage}%</div>
                            <div class="stat-label">Score</div>
                        </div>
                    </div>
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn-primary" onclick="startQuiz()">Retake Quiz</button>
                        <button class="btn-secondary" onclick="showRedoQuestions()">Review Mistakes</button>
                    </div>
                    ${redoQuestions.length > 0 ? `
                        <div class="redo-section">
                            <div class="redo-title">üìö Questions to Review:</div>
                            <ul class="redo-list">
                                ${redoQuestions.map(qId => {
                                    const q = quizzes.find(x => x.id === qId);
                                    return `<li class="redo-item">${q.question}</li>`;
                                }).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
            document.getElementById('mainContent').innerHTML = html;
        }

        function showRedoQuestions() {
            if (redoQuestions.length === 0) {
                alert("No questions to redo. Start a quiz first!");
                return;
            }
            let html = '';
            redoQuestions.forEach(qId => {
                const q = quizzes.find(x => x.id === qId);
                html += `
                    <div style="background-color: var(--color-background); padding: 15px; margin-bottom: 15px; border-radius: 6px; border-left: 3px solid var(--color-error);">
                        <strong style="color: var(--color-text);">${q.question}</strong>
                        <div style="margin-top: 10px; font-size: 14px; color: var(--color-text-secondary);">
                            <strong>Correct Answer:</strong> ${q.options[q.correct]}
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: var(--color-text);">
                            <strong>Explanation:</strong> ${q.explanation}
                        </div>
                    </div>
                `;
            });
            document.getElementById('redoContent').innerHTML = html;
            document.getElementById('redoModal').classList.add('show');
        }

        function closeRedoModal() {
            document.getElementById('redoModal').classList.remove('show');
        }

        function toggleFilters() {
            const filter = document.getElementById('filterSection');
            filter.style.display = filter.style.display === 'none' ? 'block' : 'none';
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                answeredQuestions = {};
                redoQuestions = [];
                currentQuestionIndex = 0;
                score = 0;
                quizActive = false;
                document.getElementById('statsSection').style.display = 'none';
                document.getElementById('progressContainer').style.display = 'none';
                document.getElementById('mainContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>Click "Start Quiz" to begin testing your knowledge!</p>
                    </div>
                `;
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('redoModal');
            if (event.target == modal) {
                closeRedoModal();
            }
        }
    </script>
</body>
</html>
